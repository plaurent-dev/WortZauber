<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Uhrentraining</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link id="styleLink" rel="stylesheet" href="styles.css?v=1.0.4">
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-DVYSW3YGYJ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-DVYSW3YGYJ');
    </script>
    
    <script>
        // Version Manager et Application du th√®me
        const APP_VERSION = '1.0.4';
        const savedTheme = localStorage.getItem('wortzauber-theme') || 'modern';
        const styleLink = document.getElementById('styleLink');
        const baseHref = savedTheme === 'soft' ? 'styles-soft.css' : 'styles.css';
        styleLink.href = baseHref + '?v=' + APP_VERSION;
    </script>
    <style>
        /* BOUTON DE RETOUR */
        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 12px 20px;
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            text-decoration: none;
        }

        .back-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(102, 126, 234, 0.4);
        }

        .back-btn:active {
            transform: translateY(0);
        }

        @media (max-width: 600px) {
            .back-btn {
                padding: 10px 16px;
                font-size: 0.9em;
            }
        }

        .style-toggle-btn {
            padding: 8px 16px;
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .style-toggle-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-btn">‚Üê Zur√ºck</a>
    <nav class="navbar">
        <div class="navbar-content">
            <h1>‚ú® Wortzauber</h1>
        </div>
    </nav>

    <div class="container">
        <h1 style="margin-top: 0;">Uhrentraining</h1>
        <p class="subtitle">Wie sp√§t ist es? Lies die Uhr und gib die Antwort auf Deutsch ein.</p>

        <div class="quiz-section">
            <div style="display: flex; gap: 30px; align-items: flex-start; justify-content: center; flex-wrap: wrap;">
                <!-- Horloge Analogique et Num√©rique -->
                <div class="clock-wrapper">
                    <div class="time-indicator" id="timeIndicator">‚òÄÔ∏è</div>
                    <div class="clock-container">
                        <svg viewBox="0 0 200 200" id="clockSvg">
                            <!-- Cercle de l'horloge -->
                            <circle cx="100" cy="100" r="95" fill="white" stroke="#c41e3a" stroke-width="3"/>
                            
                            <!-- Crans pour les minutes (60 petits traits) -->
                            <g stroke="#999" stroke-width="1">
                                <line x1="100" y1="8" x2="100" y2="12" />
                                <line x1="100" y1="188" x2="100" y2="192" />
                                <line x1="8" y1="100" x2="12" y2="100" />
                                <line x1="188" y1="100" x2="192" y2="100" />
                                
                                <!-- Crans pour chaque minute -->
                                <g id="minuteMarks" />
                            </g>

                            <!-- Chiffres -->
                            <text x="100" y="25" text-anchor="middle" font-size="16" font-weight="bold" fill="#c41e3a">12</text>
                            <text x="175" y="105" text-anchor="middle" font-size="16" font-weight="bold" fill="#c41e3a">3</text>
                            <text x="100" y="185" text-anchor="middle" font-size="16" font-weight="bold" fill="#c41e3a">6</text>
                            <text x="25" y="105" text-anchor="middle" font-size="16" font-weight="bold" fill="#c41e3a">9</text>

                            <!-- Traits horaires (plus √©pais pour les heures) -->
                            <g stroke="#c41e3a" stroke-width="2">
                                <line x1="100" y1="10" x2="100" y2="20"/>
                                <line x1="100" y1="180" x2="100" y2="190"/>
                                <line x1="10" y1="100" x2="20" y2="100"/>
                                <line x1="180" y1="100" x2="190" y2="100"/>
                            </g>

                            <!-- Centre -->
                            <circle cx="100" cy="100" r="5" fill="#c41e3a"/>
                            
                            <!-- Aiguille des heures -->
                            <line id="hourHand" x1="100" y1="100" x2="100" y2="60" stroke="#c41e3a" stroke-width="4" stroke-linecap="round" transform="rotate(0 100 100)"/>
                            
                            <!-- Aiguille des minutes -->
                            <line id="minuteHand" x1="100" y1="100" x2="100" y2="30" stroke="#4ecdc4" stroke-width="3" stroke-linecap="round" transform="rotate(0 100 100)"/>
                        </svg>
                    </div>
                    <!-- Horloge Num√©rique -->
                    <div id="digitalClock" style="font-size: 3em; font-weight: 700; font-family: 'Courier New', monospace; color: var(--primary); background: var(--gris-clair); padding: 15px 25px; border-radius: 8px; border: 2px solid var(--rouge-brique); min-width: 160px; text-align: center; margin-top: 15px;">
                        --:--
                    </div>
                </div>

                <!-- Formulaire -->
                <div class="controls">
                    <div class="control-group">
                        <label for="heureInput">Wie sp√§t ist es? (z.B.: "f√ºnf vor sieben")</label>
                        <input type="text" id="heureInput" placeholder="Gib die Antwort auf Deutsch ein..." onkeypress="if(event.key==='Enter') validerReponse()">
                    </div>

                    <div class="buttons">
                        <button class="btn btn-validate" onclick="validerReponse()">‚úì √úberpr√ºfen</button>
                        <button class="btn btn-next" onclick="nouvelleHeure()" style="grid-column: 1 / -1;">üîÑ Neue Uhrzeit</button>
                    </div>

                    <div class="result" id="result"></div>
                    <div class="hint" id="hint" style="display: none;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let heureActuelle = null;
        let minutesActuelles = null;
        let bonneReponse = null;

        // G√©n√©rer les heures avec minutes
        function genererHeures() {
            const heures = [];
            
            for (let h = 0; h < 24; h++) {
                for (let m = 0; m < 60; m += 5) {
                    let heure24 = h;
                    let heureAffichage = h === 0 ? 12 : (h > 12 ? h - 12 : h);
                    let minutes = m;
                    
                    let texteDE = '';
                    
                    if (m === 0) {
                        const nombresMots = {
                            1: 'eins', 2: 'zwei', 3: 'drei', 4: 'vier', 5: 'f√ºnf',
                            6: 'sechs', 7: 'sieben', 8: 'acht', 9: 'neun', 10: 'zehn',
                            11: 'elf', 12: 'zw√∂lf'
                        };
                        texteDE = `${nombresMots[heureAffichage]} Uhr`;
                    } else if (m === 5) {
                        texteDE = `f√ºnf nach ${heureAffichage}`;
                    } else if (m === 10) {
                        texteDE = `zehn nach ${heureAffichage}`;
                    } else if (m === 15) {
                        texteDE = `viertel nach ${heureAffichage}`;
                    } else if (m === 20) {
                        texteDE = `zwanzig nach ${heureAffichage}`;
                    } else if (m === 25) {
                        texteDE = `f√ºnfundzwanzig nach ${heureAffichage}`;
                    } else if (m === 30) {
                        let heureNext = heureAffichage + 1;
                        if (heureNext > 12) heureNext = 1;
                        texteDE = `halb ${heureNext}`;
                    } else if (m === 35) {
                        let heureNext = heureAffichage + 1;
                        if (heureNext > 12) heureNext = 1;
                        texteDE = `f√ºnfunddrei√üig nach ${heureAffichage}`;
                    } else if (m === 40) {
                        let heureNext = heureAffichage + 1;
                        if (heureNext > 12) heureNext = 1;
                        texteDE = `zwanzig vor ${heureNext}`;
                    } else if (m === 45) {
                        let heureNext = heureAffichage + 1;
                        if (heureNext > 12) heureNext = 1;
                        texteDE = `viertel vor ${heureNext}`;
                    } else if (m === 50) {
                        let heureNext = heureAffichage + 1;
                        if (heureNext > 12) heureNext = 1;
                        texteDE = `zehn vor ${heureNext}`;
                    } else if (m === 55) {
                        let heureNext = heureAffichage + 1;
                        if (heureNext > 12) heureNext = 1;
                        texteDE = `f√ºnf vor ${heureNext}`;
                    }
                    
                    heures.push({ heure24, heureAffichage, minutes, texteDE, index: heures.length });
                }
            }
            return heures;
        }

        const toutesHeures = genererHeures();

        function nouvelleHeure() {
            document.getElementById('result').textContent = '';
            document.getElementById('hint').style.display = 'none';
            document.getElementById('heureInput').value = '';
            document.getElementById('heureInput').focus();

            const randomIndex = Math.floor(Math.random() * toutesHeures.length);
            const heure = toutesHeures[randomIndex];
            heureActuelle = heure.heure24;
            minutesActuelles = heure.minutes;
            bonneReponse = heure;
            
            afficherHorloge(heureActuelle, minutesActuelles);
            afficherIndicateurTemps(heureActuelle);
        }

        function afficherIndicateurTemps(heure) {
            const indicator = document.getElementById('timeIndicator');
            if (heure >= 6 && heure < 18) {
                indicator.textContent = '‚òÄÔ∏è';
            } else {
                indicator.textContent = 'üåô';
            }
        }

        function afficherHorloge(heure, minutes) {
            const minutesRotation = (minutes / 60) * 360;
            const heuresRotation = ((heure % 12) * 30) + (minutes / 60) * 30;

            document.getElementById('hourHand').setAttribute('transform', `rotate(${heuresRotation} 100 100)`);
            document.getElementById('minuteHand').setAttribute('transform', `rotate(${minutesRotation} 100 100)`);
            
            // Afficher aussi l'horloge num√©rique
            let h = heure < 10 ? '0' + heure : heure;
            let min = minutes < 10 ? '0' + minutes : minutes;
            document.getElementById('digitalClock').textContent = `${h}:${min}`;
        }

        function normaliserTexte(texte) {
            return texte.toLowerCase().trim().replace(/\s+/g, ' ');
        }

        function convertirNombresEnChiffres(texte) {
            const nombresMots = {
                'null': '0', 'eins': '1', 'zwei': '2', 'drei': '3', 'vier': '4', 'f√ºnf': '5',
                'sechs': '6', 'sieben': '7', 'acht': '8', 'neun': '9', 'zehn': '10', 'elf': '11', 'zw√∂lf': '12'
            };
            
            let resultat = texte;
            Object.keys(nombresMots).forEach(mot => {
                const regex = new RegExp(`\\b${mot}\\b`, 'g');
                resultat = resultat.replace(regex, nombresMots[mot]);
            });
            return resultat;
        }

        function validerReponse() {
            const input = document.getElementById('heureInput');
            const reponse = normaliserTexte(input.value);
            const resultDiv = document.getElementById('result');
            const hintDiv = document.getElementById('hint');
            
            if (!bonneReponse) {
                resultDiv.innerHTML = '<div class="result incorrect">‚úó Gib eine Antwort ein!</div>';
                resultDiv.className = 'result incorrect';
                hintDiv.style.display = 'none';
                return;
            }

            const correctAnswer = normaliserTexte(bonneReponse.texteDE);
            
            // Variantes accept√©es (avec nombres en chiffres ou en lettres)
            let equivalents = [correctAnswer];
            
            // G√©n√©rer les √©quivalences pour diff√©rentes formulations
            if (correctAnswer.includes('uhr')) {
                // Variantes pour les heures justes
                const match = correctAnswer.match(/(\w+) uhr/);
                if (match) {
                    equivalents.push(correctAnswer.replace(/\s+/g, ' '));
                }
            }
            
            // V√©rifier si la r√©ponse correspond √† l'une des formes √©quivalentes
            const isCorrect = equivalents.some(eq => {
                const eqNormalized = normaliserTexte(eq);
                const reponseNormalized = normaliserTexte(reponse);
                
                return reponseNormalized === eqNormalized || 
                       reponseNormalized === normaliserTexte(eq);
            });

            if (isCorrect) {
                resultDiv.innerHTML = `
                    <div class="result correct">
                        ‚úì Richtig!
                        <div class="result-text">${bonneReponse.texteDE}</div>
                    </div>
                `;
                hintDiv.style.display = 'none';
                input.style.borderColor = '#2e7d32';
            } else {
                resultDiv.innerHTML = `
                    <div class="result incorrect">
                        ‚úó Falsch.
                        <div class="result-text">Richtige Antwort: ${bonneReponse.texteDE}</div>
                    </div>
                `;
                input.style.borderColor = '#c62828';
                
                // Afficher un indice
                const words = correctAnswer.split(' ');
                const firstWord = words[0];
                hintDiv.textContent = `üí° Tipp: Beginnt mit "${firstWord}"`;
                hintDiv.style.display = 'block';
            }
        }

        // G√©n√©rer les crans pour les 60 minutes
        function genererCrans() {
            const minuteMarksGroup = document.getElementById('minuteMarks');
            for (let i = 1; i < 60; i++) {
                if (i % 5 !== 0) {
                    const angle = (i * 6);
                    const rad = (angle * Math.PI) / 180;
                    const x1 = 100 + 85 * Math.sin(rad);
                    const y1 = 100 - 85 * Math.cos(rad);
                    const x2 = 100 + 90 * Math.sin(rad);
                    const y2 = 100 - 90 * Math.cos(rad);
                    
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', x1);
                    line.setAttribute('y1', y1);
                    line.setAttribute('x2', x2);
                    line.setAttribute('y2', y2);
                    line.setAttribute('stroke', '#999');
                    line.setAttribute('stroke-width', '1');
                    minuteMarksGroup.appendChild(line);
                }
            }
        }

        // Appeler la fonction au chargement
        window.addEventListener('load', () => {
            genererCrans();
            nouvelleHeure();
            initThemeToggle();
        });

        // ====== THEME TOGGLE ======
        function initThemeToggle() {
            const toggleBtn = document.getElementById('styleToggle');
            const savedTheme = localStorage.getItem('wortzauber-theme') || 'modern';
            
            applyTheme(savedTheme);
            
            toggleBtn.addEventListener('click', function() {
                const currentTheme = localStorage.getItem('wortzauber-theme') || 'modern';
                const newTheme = currentTheme === 'modern' ? 'soft' : 'modern';
                applyTheme(newTheme);
                localStorage.setItem('wortzauber-theme', newTheme);
            });
        }

        function applyTheme(themeName) {
            const styleLink = document.getElementById('styleLink');
            const toggleBtn = document.getElementById('styleToggle');
            
            if (themeName === 'soft') {
                styleLink.href = 'styles-soft.css';
                toggleBtn.textContent = 'üé® Modern';
                toggleBtn.setAttribute('title', 'Wechsel zu modernem Design');
            } else {
                styleLink.href = 'styles.css';
                toggleBtn.textContent = 'üé® Soft';
                toggleBtn.setAttribute('title', 'Wechsel zu weichem Design');
            }
        }
    </script>
</body>
</html>