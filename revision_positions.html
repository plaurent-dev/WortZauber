<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>R√§umliche Positionen - Deutsche St√§dte</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link id="styleLink" rel="stylesheet" href="styles.css">
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDYnaelzF3AanXmOGDG8j9kv3GyETYf1Js"></script>
    <script>
        // Appliquer le th√®me sauvegard√© d√®s le chargement
        const savedTheme = localStorage.getItem('wortzauber-theme') || 'modern';
        const styleLink = document.getElementById('styleLink');
        if (savedTheme === 'soft') {
            styleLink.href = 'styles-soft.css';
        } else {
            styleLink.href = 'styles.css';
        }
    </script>
    <style>
        /* BOUTON DE RETOUR */
        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 12px 20px;
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            text-decoration: none;
        }

        .back-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(102, 126, 234, 0.4);
        }

        .back-btn:active {
            transform: translateY(0);
        }

        @media (max-width: 600px) {
            .back-btn {
                padding: 10px 16px;
                font-size: 0.9em;
            }
        }

        
        .positions-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: start;
            margin-top: 30px;
        }

        #map {
            width: 100%;
            height: 500px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .exercise-box {
            background: var(--bg-light-gray);
            padding: 30px;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }

        .city-display {
            margin-bottom: 25px;
        }

        .city-name {
            font-size: 1.3em;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .direction-question {
            font-size: 1.1em;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .option-btn {
            padding: 15px;
            border: 2px solid var(--border);
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
            font-weight: 600;
            text-align: left;
            color: var(--text-dark);
        }

        .option-btn:hover {
            border-color: var(--primary);
            background: var(--info);
            transform: translateX(5px);
        }

        .option-btn.selected {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
        }

        .option-btn.correct {
            border-color: var(--success);
            background: var(--success);
            color: white;
        }

        .option-btn.incorrect {
            border-color: var(--accent);
            background: var(--accent);
            color: white;
        }

        .feedback {
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-weight: 600;
            display: none;
        }

        .feedback.correct {
            background: #D1FAE5;
            color: #065F46;
            border-left: 4px solid var(--success);
            display: block;
        }

        .feedback.incorrect {
            background: #FEE2E2;
            color: #7F1D1D;
            border-left: 4px solid var(--accent);
            display: block;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .listen-btn {
            padding: 8px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.95em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
            display: inline-block;
        }

        .listen-btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(102, 126, 234, 0.3);
        }

        .listen-btn:active {
            transform: translateY(0);
        }

        .btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 1em;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            background: var(--text-light);
            cursor: not-allowed;
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            background: var(--secondary-dark);
            transform: translateY(-2px);
        }

        .score {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            background: var(--info);
            border-radius: 8px;
            font-weight: 600;
            color: var(--primary);
            font-size: 1.1em;
        }

        .memory {
            background: #FEF3C7;
            border-left: 4px solid var(--warning);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            color: #92400E;
            line-height: 1.6;
        }

        @media (max-width: 1024px) {
            .positions-container {
                grid-template-columns: 1fr;
            }

            #map {
                height: 400px;
            }
        }

        .marker-title {
            font-weight: 700;
            color: var(--primary);
        }

        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .stat-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid var(--border);
        }

        .stat-label {
            font-size: 0.9em;
            color: var(--text-medium);
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: 700;
            color: var(--primary);
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-btn">‚Üê Zur√ºck</a>
    <nav class="navbar">
        <div class="navbar-content">
            <h1>üìö DE</h1>
            <div class="navbar-buttons">
            </div>
        </div>
    </nav>

    <div class="container">
        <h1 style="margin-top: 0;">√úbung: R√§umliche Positionen</h1>
        <p class="subtitle">Lokalisiere zwei zuf√§llig ausgew√§hlte deutsche St√§dte mit Hilfe von r√§umlichen Ausdr√ºcken!</p>

        <div class="memory">
            <strong>üìù Erinnerung :</strong> <br>
            <b>n√∂rdlich von</b> = Nord von | 
            <b>s√ºdlich von</b> = S√ºd von |
            <b>westlich von</b> = West von | 
            <b>√∂stlich von</b> = Ost von | 
            <b>nordwestlich von</b> = Nordwest von | 
            <b>s√ºdwestlich von</b> = S√ºdwest von |
            <b>nord√∂stlich von</b> = Nordost von | 
            <b>s√ºd√∂stlich von</b> = S√ºdost von
        </div>

        <div class="positions-container">
            <div>
                <div id="map"></div>
                <div class="score">
                    Korrekte Antworten: <span id="scoreValue">0</span> / <span id="totalValue">0</span>
                </div>
            </div>

            <div class="exercise-box">
                <div class="city-display">
                    <div class="city-name" id="cityName">Wird geladen...</div>
                    <div class="direction-question" id="questionText">Warte auf das Laden...</div>
                </div>

                <div class="options" id="optionsContainer"></div>

                <div class="feedback" id="feedback"></div>

                <div class="button-group">
                    <button class="btn btn-primary" id="validateBtn" onclick="validerReponse()" disabled>Best√§tigen</button>
                    <button class="btn btn-secondary" id="nextBtn" onclick="nouvelleQuestion()" style="display: none;">N√§chste Frage</button>
                </div>

                <div class="stats">
                    <div class="stat-box">
                        <div class="stat-label">Richtige Antworten</div>
                        <div class="stat-value" id="correctCount">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Erfolgsquote</div>
                        <div class="stat-value" id="percentage">0%</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Liste der 50+ deutschen St√§dte mit ihren GPS-Koordinaten
        const villes = [
            { nom: 'Berlin', lat: 52.5200, lng: 13.4050 },
            { nom: 'M√ºnchen', lat: 48.1351, lng: 11.5820 },
            { nom: 'Hamburg', lat: 53.5511, lng: 9.9937 },
            { nom: 'K√∂ln', lat: 50.9375, lng: 6.9603 },
            { nom: 'Frankfurt', lat: 50.1109, lng: 8.6821 },
            { nom: 'Stuttgart', lat: 48.7758, lng: 9.1829 },
            { nom: 'D√ºsseldorf', lat: 51.2277, lng: 6.7735 },
            { nom: 'Dortmund', lat: 51.5136, lng: 7.4653 },
            { nom: 'Essen', lat: 51.4556, lng: 7.0116 },
            { nom: 'Leipzig', lat: 51.3397, lng: 12.3731 },
            { nom: 'Dresden', lat: 51.0504, lng: 13.7373 },
            { nom: 'Hannover', lat: 52.3759, lng: 9.7320 },
            { nom: 'N√ºrnberg', lat: 49.4521, lng: 11.0767 },
            { nom: 'Duisburg', lat: 51.4344, lng: 6.7573 },
            { nom: 'Bochum', lat: 51.4819, lng: 7.2147 },
            { nom: 'Wuppertal', lat: 51.2629, lng: 7.1496 },
            { nom: 'Bielefeld', lat: 52.0302, lng: 8.5325 },
            { nom: 'Bonn', lat: 50.7365, lng: 7.0998 },
            { nom: 'Mannheim', lat: 49.4891, lng: 8.4673 },
            { nom: 'Karlsruhe', lat: 49.0134, lng: 8.4043 },
            { nom: 'Augsburg', lat: 48.3705, lng: 10.8978 },
            { nom: 'Wiesbaden', lat: 50.0829, lng: 8.2430 },
            { nom: 'M√∂nchengladbach', lat: 51.1629, lng: 6.3925 },
            { nom: 'Gelsenkirchen', lat: 51.4555, lng: 7.0956 },
            { nom: 'Aachen', lat: 50.7766, lng: 6.0840 },
            { nom: 'Kiel', lat: 54.3233, lng: 10.1348 },
            { nom: 'Magdeburg', lat: 52.1205, lng: 11.6281 },
            { nom: 'Ulm', lat: 48.3985, lng: 9.9937 },
            { nom: 'Heidelberg', lat: 49.4124, lng: 8.7129 },
            { nom: 'W√ºrzburg', lat: 49.8047, lng: 9.9377 },
            { nom: 'Freiburg', lat: 48.0021, lng: 7.8421 },
            { nom: 'Rostock', lat: 54.0887, lng: 12.0977 },
            { nom: 'Erfurt', lat: 50.9848, lng: 11.0268 },
            { nom: 'Saarbr√ºcken', lat: 49.2392, lng: 6.9965 },
            { nom: 'Potsdam', lat: 52.3906, lng: 13.0645 },
            { nom: 'Mainz', lat: 50.0049, lng: 8.2784 },
            { nom: 'Remscheid', lat: 51.1797, lng: 7.1968 },
            { nom: 'Solingen', lat: 51.1708, lng: 7.0892 },
            { nom: 'Hagen', lat: 51.3599, lng: 7.4455 },
            { nom: 'Salzgitter', lat: 52.1438, lng: 10.3240 },
            { nom: 'Osnabr√ºck', lat: 52.2799, lng: 8.0432 },
            { nom: 'Ludwigshafen', lat: 49.4778, lng: 8.4427 },
            { nom: 'Heilbronn', lat: 49.1386, lng: 9.2200 },
            { nom: 'Pforzheim', lat: 48.8936, lng: 8.7048 },
            { nom: 'Oldenburg', lat: 53.1437, lng: 8.2156 },
            { nom: 'Wolfsburg', lat: 52.4220, lng: 10.7757 },
            { nom: 'G√∂ttingen', lat: 51.5340, lng: 9.9356 },
            { nom: 'Gera', lat: 50.8677, lng: 12.0828 },
            { nom: 'Passau', lat: 48.5726, lng: 13.4662 },
            { nom: 'Bayreuth', lat: 49.9447, lng: 11.5791 }
        ];

        // Directions possibles (en ordre: N, NE, E, SE, S, SW, W, NW)
        const directions = [
            { de: 'n√∂rdlich von', angle: 0 },
            { de: 'nord√∂stlich von', angle: 45 },
            { de: '√∂stlich von', angle: 90 },
            { de: 's√ºd√∂stlich von', angle: 135 },
            { de: 's√ºdlich von', angle: 180 },
            { de: 's√ºdwestlich von', angle: 225 },
            { de: 'westlich von', angle: 270 },
            { de: 'nordwestlich von', angle: 315 }
        ];

        let map;
        let markers = [];
        let currentQuestion = null;
        let selectedOption = null;
        let correctAnswer = null;
        let questionAnswered = false;
        let correctCount = 0;
        let totalCount = 0;
        const MAX_QUESTIONS = 10;

        function initMap() {
            const centerDe = { lat: 51.1657, lng: 10.4515 };
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 6,
                center: centerDe,
                mapTypeControl: false,
                fullscreenControl: false,
                streetViewControl: false
            });
        }

        function calculerDirection(city1, city2) {
            const lat1 = city1.lat * Math.PI / 180;
            const lon1 = city1.lng * Math.PI / 180;
            const lat2 = city2.lat * Math.PI / 180;
            const lon2 = city2.lng * Math.PI / 180;

            const dLon = lon2 - lon1;
            const y = Math.sin(dLon) * Math.cos(lat2);
            const x = Math.cos(lat1) * Math.sin(lat2) - Math.sin(lat1) * Math.cos(lat2) * Math.cos(dLon);
            let bearing = Math.atan2(y, x) * 180 / Math.PI;
            bearing = (bearing + 360) % 360;

            return bearing;
        }

        function obtenirDirectionCorrecte(bearing) {
            // Trouver la direction la plus proche
            const directions_sorted = [...directions].sort((a, b) => {
                const diffA = Math.abs(a.angle - bearing);
                const diffB = Math.abs(b.angle - bearing);
                return diffA - diffB;
            });
            return directions_sorted[0];
        }

        function genererOptionsAleatoires(correctAnswer) {
            const allOptions = directions.filter(d => d.de !== correctAnswer.de);
            const shuffled = allOptions.sort(() => Math.random() - 0.5);
            const options = [correctAnswer, ...shuffled.slice(0, 3)];
            return options.sort(() => Math.random() - 0.5);
        }

        function afficherMarkers(city1, city2) {
            // Effacer les anciens marqueurs
            markers.forEach(marker => marker.setMap(null));
            markers = [];

            // Ajouter les deux villes
            const marker1 = new google.maps.Marker({
                position: { lat: city1.lat, lng: city1.lng },
                map: map,
                title: city1.nom,
                label: '1',
                icon: 'http://maps.google.com/mapfiles/ms/icons/blue-dot.png'
            });

            const marker2 = new google.maps.Marker({
                position: { lat: city2.lat, lng: city2.lng },
                map: map,
                title: city2.nom,
                label: '2',
                icon: 'http://maps.google.com/mapfiles/ms/icons/red-dot.png'
            });

            markers.push(marker1, marker2);

            // Ajuster la vue pour voir les deux marqueurs
            const bounds = new google.maps.LatLngBounds();
            bounds.extend(marker1.getPosition());
            bounds.extend(marker2.getPosition());
            map.fitBounds(bounds);
            setTimeout(() => map.fitBounds(bounds), 100);
        }

        function nouvelleQuestion() {
            // V√©rifier si l'exercice est termin√©
            if (totalCount >= MAX_QUESTIONS) {
                afficherEcranFin();
                return;
            }

            questionAnswered = false;
            selectedOption = null;
            document.getElementById('validateBtn').style.display = 'block';
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('validateBtn').disabled = false;
            document.getElementById('feedback').className = 'feedback';
            document.getElementById('feedback').textContent = '';

            // Choisir deux villes al√©atoires diff√©rentes
            const city1 = villes[Math.floor(Math.random() * villes.length)];
            let city2 = villes[Math.floor(Math.random() * villes.length)];
            while (city2.nom === city1.nom) {
                city2 = villes[Math.floor(Math.random() * villes.length)];
            }

            // Calculer la direction correcte
            const bearing = calculerDirection(city1, city2);
            const correctDir = obtenirDirectionCorrecte(bearing);
            correctAnswer = correctDir;

            // G√©n√©rer les options
            const options = genererOptionsAleatoires(correctDir);

            // Afficher les marqueurs
            afficherMarkers(city1, city2);

            // Mettre √† jour l'interface
            currentQuestion = { city1, city2, bearing };
            document.getElementById('cityName').textContent = '';
            document.getElementById('questionText').innerHTML = 
                `<strong>${city2.nom}</strong> (2 üî¥) liegt <span style="font-size: 1.3em; font-weight: bold; color: var(--primary);">........................</span> <strong>${city1.nom}</strong> (1 üîµ). ?`;

            // Afficher les options
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            options.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = option.de;
                btn.onclick = () => selectionnerOption(btn, option);
                optionsContainer.appendChild(btn);
            });

            totalCount++;
            updateScore();
        }

        function selectionnerOption(btn, option) {
            if (questionAnswered) return;

            // D√©s√©lectionner l'option pr√©c√©dente
            document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
            
            // S√©lectionner la nouvelle option
            btn.classList.add('selected');
            selectedOption = option;
            document.getElementById('validateBtn').disabled = false;
        }

        function validerReponse() {
            if (!selectedOption || questionAnswered) return;

            questionAnswered = true;
            const isCorrect = selectedOption.de === correctAnswer.de;

            if (isCorrect) {
                correctCount++;
                document.getElementById('feedback').className = 'feedback correct';
                const sentenceCorrect = `${currentQuestion.city2.nom} liegt ${correctAnswer.de} ${currentQuestion.city1.nom}`;
                document.getElementById('feedback').innerHTML = 
                    `‚úÖ <strong>Richtig !</strong> ${sentenceCorrect}.<br><button class="listen-btn" onclick="ecouter('${sentenceCorrect}')">üîä Satz anh√∂ren</button>`;
                document.querySelectorAll('.option-btn').forEach(btn => {
                    if (btn.textContent === correctAnswer.de) {
                        btn.classList.add('correct');
                    }
                });
            } else {
                document.getElementById('feedback').className = 'feedback incorrect';
                const sentenceIncorrect = `${currentQuestion.city2.nom} liegt ${correctAnswer.de} ${currentQuestion.city1.nom}`;
                document.getElementById('feedback').innerHTML = 
                    `‚ùå <strong>Falsch !</strong> ${sentenceIncorrect}.<br><button class="listen-btn" onclick="ecouter('${sentenceIncorrect}')">üîä Satz anh√∂ren</button>`;
                document.querySelectorAll('.option-btn').forEach(btn => {
                    if (btn.textContent === correctAnswer.de) {
                        btn.classList.add('correct');
                    } else if (btn.textContent === selectedOption.de) {
                        btn.classList.add('incorrect');
                    }
                });
            }

            document.getElementById('validateBtn').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'block';
            updateScore();
        }

        // Funktion zum Aussprechen eines Satzes auf Deutsch
        function ecouter(texte) {
            // Aktuelle Sprachausgabe stoppen, falls vorhanden
            window.speechSynthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance(texte);
            utterance.lang = 'de-DE';  // Deutsch
            utterance.rate = 0.9;      // Leicht verlangsamte Sprechgeschwindigkeit f√ºr Klarheit
            utterance.pitch = 1;
            
            window.speechSynthesis.speak(utterance);
        }

        function updateScore() {
            document.getElementById('scoreValue').textContent = correctCount;
            document.getElementById('totalValue').textContent = totalCount;
            document.getElementById('correctCount').textContent = correctCount;
            
            if (totalCount > 0) {
                const percentage = Math.round((correctCount / totalCount) * 100);
                document.getElementById('percentage').textContent = percentage + '%';
            }
        }

        function afficherEcranFin() {
            const percentage = Math.round((correctCount / MAX_QUESTIONS) * 100);
            let message = '';
            let emoji = 'üòä';
            
            if (percentage === 100) {
                message = 'Perfekt! üåü Du beherrschst r√§umliche Positionen!';
                emoji = 'üåü';
            } else if (percentage >= 80) {
                message = 'Sehr gut! üëè Du bist fast perfekt!';
                emoji = 'üëè';
            } else if (percentage >= 60) {
                message = 'Gut! üëç Weiterhin √ºben!';
                emoji = 'üëç';
            } else {
                message = 'Zu √ºberarbeiten! üìö Versuche es erneut um dich zu verbessern!';
                emoji = 'üìö';
            }

            const exerciseBox = document.querySelector('.exercise-box');
            exerciseBox.innerHTML = `
                <div style="text-align: center; padding: 40px 20px;">
                    <div style="font-size: 4em; margin-bottom: 20px;">${emoji}</div>
                    <h2 style="color: var(--primary); font-size: 1.8em; margin-bottom: 15px;">√úbung beendet!</h2>
                    <p style="font-size: 1.2em; margin-bottom: 30px;">${message}</p>
                    
                    <div class="stats" style="margin: 30px 0;">
                        <div class="stat-box">
                            <div class="stat-label">Endergebnis</div>
                            <div class="stat-value">${correctCount}/${MAX_QUESTIONS}</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-label">Prozentsatz</div>
                            <div class="stat-value">${percentage}%</div>
                        </div>
                    </div>
                    
                    <button class="btn btn-secondary" onclick="location.reload()" style="margin-top: 30px; padding: 15px 30px; font-size: 1.1em;">
                        üîÑ Neustarten
                    </button>
                </div>
            `;

            // Cacher la carte
            document.getElementById('map').style.display = 'none';
            document.querySelector('.score').style.display = 'none';
        }

        // Initialisation
        window.addEventListener('load', () => {
            initMap();
            nouvelleQuestion();
        });
    </script>
</body>
</html>
